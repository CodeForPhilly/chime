
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>The chime-live Cluster Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="heroku.html" />
    
    
    <link rel="prev" href="release-process.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Getting Started
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../getting-started/try-online.html">
            
                <a href="../getting-started/try-online.html">
            
                    
                    Try Online
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../getting-started/run-locally.html">
            
                <a href="../getting-started/run-locally.html">
            
                    
                    Run Locally
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../CONTRIBUTING.html">
            
                <a href="../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../contributing/app-dev.html">
            
                <a href="../contributing/app-dev.html">
            
                    
                    Application Development
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../contributing/data-analysis.html">
            
                <a href="../contributing/data-analysis.html">
            
                    
                    Data Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../contributing/operations-support.html">
            
                <a href="../contributing/operations-support.html">
            
                    
                    Operations Support
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Operations
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="release-process.html">
            
                <a href="release-process.html">
            
                    
                    Release Process
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="chime-live-cluster.html">
            
                <a href="chime-live-cluster.html">
            
                    
                    The chime-live Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="heroku.html">
            
                <a href="heroku.html">
            
                    
                    Deploy to Heroku
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="byok8s.html">
            
                <a href="byok8s.html">
            
                    
                    Deploy to Your Own Cluster
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../CODE_OF_CONDUCT.html">
            
                <a href="../CODE_OF_CONDUCT.html">
            
                    
                    Code of Conduct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../MAINTAINERS.html">
            
                <a href="../MAINTAINERS.html">
            
                    
                    Maintainers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../GLOSSARY.html">
            
                <a href="../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >The chime-live Cluster</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="operations-the-chime-live-cluster">Operations: The <code>chime-live</code> Cluster</h1>
<h2 id="connecting-with-kubectl">Connecting with <code>kubectl</code></h2>
<ol>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank">Install kubectl</a></li>
<li><a href="https://krew.sigs.k8s.io/docs/user-guide/setup/install/" target="_blank">Install Krew</a>:</li>
<li><p><a href="https://github.com/corneliusweig/konfig#via-krew" target="_blank">Install konfig</a>:</p>
<pre><code class="lang-bash"> kubectl krew install konfig
</code></pre>
</li>
<li><p>Obtain <code>chime-live-kubeconfig.yaml</code> file from Code for Philly ops team</p>
<ul>
<li>This file contains connection details and credentials for managing the cluster, treat its contents as top-secret!</li>
</ul>
</li>
<li><p>Merge <code>chime-live-kubeconfig.yaml</code> into your local configuration:</p>
<pre><code class="lang-bash"> kubectl konfig import --save ~/Downloads/chime-live-kubeconfig.yaml
</code></pre>
</li>
<li><p>Switch to <code>lke_chime-live</code> context:</p>
<pre><code class="lang-bash"> kubectl config use-context lke_chime-live
</code></pre>
</li>
<li><p>Verify connection:</p>
<pre><code class="lang-bash"> kubectl get pod --all-namespaces
</code></pre>
</li>
</ol>
<h2 id="deploying-a-new-chime-version">Deploying a New CHIME Version</h2>
<ol>
<li><a href="release-process.html">Create a new release</a></li>
<li>Wait for the <code>Docker</code> GitHub Actions workflow to complete</li>
<li>Verify the new version shows up at the top as &quot;Latest version&quot; here: <a href="https://github.com/CodeForPhilly/chime/packages/155340" target="_blank">https://github.com/CodeForPhilly/chime/packages/155340</a></li>
<li>Open a new issue on GitHub titled &quot;Deploy chime $VERSION&quot; (ex: <a href="https://github.com/CodeForPhilly/chime/issues/98" target="_blank">https://github.com/CodeForPhilly/chime/issues/98</a>)<ul>
<li>Note the PR in which the release was approved</li>
<li>Confirm that the tag for the version was created</li>
</ul>
</li>
<li><p>Create a local branch (based on &quot;develop&quot;) to perform deploy time changed on, named &quot;deploy/$VERSION&quot;</p>
<pre><code class="lang-bash"> VERSION=1.2.3
 git rev-parse --abbrev-ref HEAD
 <span class="hljs-comment"># develop</span>
 git pull
 git checkout -b deploy/<span class="hljs-variable">$VERSION</span>
</code></pre>
</li>
<li><p>Update the app.yaml manifest file</p>
<pre><code class="lang-bash"> VERSION=1.2.3
 sed -Ei <span class="hljs-string">&quot;s/(- image: .*):(.*)/\1:<span class="hljs-variable">$VERSION</span>/&quot;</span> k8s/app.yaml
 git add -A
 <span class="hljs-comment"># verify changes are as expected</span>
 git diff --staged
 git commit -m <span class="hljs-string">&quot;Deploy chime <span class="hljs-variable">$VERSION</span>&quot;</span>
</code></pre>
</li>
<li><p>Push changes</p>
<pre><code class="lang-bash"> VERSION=1.2.3
 git push -u origin deploy/<span class="hljs-variable">$VERSION</span>
</code></pre>
</li>
<li><p>Open PR on GitHub to merge changes back into develop, ideally with
the review of another DevOps admin whenever possible. Ensure to link
to the PR in the deployment issue previously opened on GitHub.</p>
</li>
<li><p>Run:</p>
<pre><code class="lang-bash"> kubectl apply <span class="hljs-_">-f</span> k8s/app.yaml
</code></pre>
</li>
<li><p>Watch rollout status:</p>
<pre><code class="lang-bash">kubectl -n chime rollout status deployment.v1.apps/chime
</code></pre>
</li>
<li><p>Confirm the expected version is running</p>
<pre><code class="lang-bash">kubectl -n chime get deployment chime -o yaml | grep image:
<span class="hljs-comment">#  - image: docker.pkg.github.com/codeforphilly/chime/penn-chime:$VERSION</span>
</code></pre>
</li>
<li><p>Paste the output from steps 11 &amp; 12 into the previously opened deployment issue
to document the successful deployment and close the issue</p>
</li>
<li>$$$ PROFIT $$$</li>
</ol>
<h2 id="applying-changes-to-k8s-manifests">Applying Changes to <code>k8s/</code> Manifests</h2>
<p>After making changes to the manifests in <code>k8s/</code> that you want to apply, first review the diff for what you&apos;re about to change using an editor that wil color-code the output and make it easy to review:</p>
<pre><code class="lang-bash">kubectl diff -Rf k8s/ | code -
</code></pre>
<p><em>Ignore any instances of <code>generation</code> being incremented</em></p>
<p>Once you&apos;re satisfied with the results of the diff, you can apply a single manifest:</p>
<pre><code class="lang-bash">kubectl apply <span class="hljs-_">-f</span> k8s/infra/ingress-nginx.yaml
</code></pre>
<p>Or the entire directory:</p>
<pre><code class="lang-bash">kubectl apply -Rf k8s/
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="release-process.html" class="navigation navigation-prev " aria-label="Previous page: Release Process">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="heroku.html" class="navigation navigation-next " aria-label="Next page: Deploy to Heroku">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"The chime-live Cluster","level":"1.4.2","depth":2,"next":{"title":"Deploy to Heroku","level":"1.4.3","depth":2,"path":"operations/heroku.md","ref":"./operations/heroku.md","articles":[]},"previous":{"title":"Release Process","level":"1.4.1","depth":2,"path":"operations/release-process.md","ref":"./operations/release-process.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["mermaid@git+https://github.com/JarvusInnovations/gitbook-plugin-mermaid.git"],"pluginsConfig":{"mermaid":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"operations/chime-live-cluster.md","mtime":"2020-03-22T05:58:32.118Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-03-22T05:58:39.452Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-mermaid/mermaid/mermaid.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mermaid/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

